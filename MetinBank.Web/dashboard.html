<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metin Bank - Ana Sayfa</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">METÄ°N BANK</div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link active">Ana Sayfa</a>
                <a href="hesaplar.html" class="nav-link">HesaplarÄ±m</a>
                <a href="havale.html" class="nav-link">Havale/EFT</a>
                <a href="ekstre.html" class="nav-link">Ekstre</a>
                <a href="kartlar.html" class="nav-link">KartlarÄ±m</a>
                <a href="profil.html" class="nav-link">Profil</a>
                <a href="#" class="nav-link" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="welcome-section">
            <h1>HoÅŸ Geldiniz, <span id="userName">...</span></h1>
            <p>Son giriÅŸ: <span id="lastLogin">...</span></p>
        </div>

        <!-- Account Summary -->
        <div class="grid-3">
            <div class="card">
                <div class="card-icon">ğŸ’°</div>
                <div class="card-title">Toplam Bakiye</div>
                <div class="card-value" id="totalBalance">0,00 TL</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-title">Aktif Hesap</div>
                <div class="card-value" id="accountCount">0</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ“ˆ</div>
                <div class="card-title">Bu Ay Ä°ÅŸlem</div>
                <div class="card-value" id="monthlyTransactions">0</div>
            </div>
        </div>

        <!-- Accounts List -->
        <div class="section">
            <h2>HesaplarÄ±m</h2>
            <div id="accountsList" class="accounts-list">
                <!-- Accounts will be loaded here -->
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="section">
            <h2>Son Ä°ÅŸlemler</h2>
            <div id="recentTransactions" class="transaction-list">
                <!-- Transactions will be loaded here -->
            </div>
        </div>

        <!-- Currency Rates -->
        <div class="section">
            <h2>DÃ¶viz KurlarÄ±</h2>
            <div id="currencyRates" class="currency-list">
                <!-- Currency rates will be loaded here -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2>HÄ±zlÄ± Ä°ÅŸlemler</h2>
            <div class="grid-4">
                <a href="havale.html" class="action-btn">
                    <div class="action-icon">ğŸ’³</div>
                    <div class="action-text">Havale</div>
                </a>
                <a href="havale.html?type=eft" class="action-btn">
                    <div class="action-icon">ğŸ¦</div>
                    <div class="action-text">EFT</div>
                </a>
                <a href="ekstre.html" class="action-btn">
                    <div class="action-icon">ğŸ“„</div>
                    <div class="action-text">Ekstre</div>
                </a>
                <a href="kartlar.html" class="action-btn">
                    <div class="action-icon">ğŸ’³</div>
                    <div class="action-text">KartlarÄ±m</div>
                </a>
            </div>
        </div>
    </div>

    <script src="assets/js/api.js"></script>
    <script src="assets/js/app.js"></script>
    <script>
        // Check authentication
        checkAuth();

        // Load dashboard data
        window.addEventListener('DOMContentLoaded', async () => {
            const user = getUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userName').textContent = `${user.ad} ${user.soyad}`;
            document.getElementById('lastLogin').textContent = new Date().toLocaleString('tr-TR');

            await loadAccounts();
            await loadRecentTransactions();
            await loadCurrencyRates();
        });

        async function loadAccounts() {
            try {
                const user = getUser();
                const response = await apiGet(`/hesap/musteri/${user.musteriID}`);

                if (response.success && response.data) {
                    const accounts = response.data;
                    let totalBalance = 0;

                    const accountsHTML = accounts.map(acc => {
                        totalBalance += acc.bakiye;
                        return `
                            <div class="account-item">
                                <div class="account-info">
                                    <div class="account-name">${acc.hesapTipi} ${acc.hesapCinsi} Hesap</div>
                                    <div class="account-iban">${formatIBAN(acc.iban)}</div>
                                </div>
                                <div class="account-balance">${formatCurrency(acc.bakiye, acc.hesapTipi)}</div>
                            </div>
                        `;
                    }).join('');

                    document.getElementById('accountsList').innerHTML = accountsHTML;
                    document.getElementById('totalBalance').textContent = formatCurrency(totalBalance, 'TL');
                    document.getElementById('accountCount').textContent = accounts.length;
                }
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }

        async function loadRecentTransactions() {
            try {
                const user = getUser();
                const response = await apiGet(`/islem/musteri/${user.musteriID}/gecmis`);

                if (response.success && response.data) {
                    const transactions = response.data.slice(0, 5); // Son 5 iÅŸlem

                    const transactionsHTML = transactions.map(tx => `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-type">${tx.islemTipi}</div>
                                <div class="transaction-date">${formatDate(tx.islemTarihi)}</div>
                                <div class="transaction-desc">${tx.aciklama || '-'}</div>
                            </div>
                            <div class="transaction-amount">${formatCurrency(tx.tutar, tx.paraBirimi)}</div>
                        </div>
                    `).join('');

                    document.getElementById('recentTransactions').innerHTML = transactionsHTML || '<p class="no-data">HenÃ¼z iÅŸlem bulunmamaktadÄ±r.</p>';
                    document.getElementById('monthlyTransactions').textContent = transactions.length;
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('recentTransactions').innerHTML = '<p class="no-data">Ä°ÅŸlemler yÃ¼klenemedi.</p>';
            }
        }

        async function loadCurrencyRates() {
            try {
                const response = await apiGet('/doviz/kurlar');

                if (response.success && response.data) {
                    const rates = response.data;

                    const ratesHTML = rates.map(rate => `
                        <div class="currency-item">
                            <div class="currency-name">${rate.paraBirimi}</div>
                            <div class="currency-rates">
                                <span>AlÄ±ÅŸ: ${rate.alisFiyati.toFixed(4)} TL</span>
                                <span>SatÄ±ÅŸ: ${rate.satisFiyati.toFixed(4)} TL</span>
                            </div>
                        </div>
                    `).join('');

                    document.getElementById('currencyRates').innerHTML = ratesHTML;
                }
            } catch (error) {
                console.error('Error loading currency rates:', error);
                document.getElementById('currencyRates').innerHTML = '<p class="no-data">DÃ¶viz kurlarÄ± yÃ¼klenemedi.</p>';
            }
        }
    </script>
</body>

</html>